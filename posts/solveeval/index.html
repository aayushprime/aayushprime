<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Python: Solving slow eval | aayushprime</title><meta name=keywords content><meta name=description content="Welcome to another one of my interesting findings, where I explore some stuff for fun and profit just fun
A while back I was solving AOC and for a problem (day 13), I had this sort of clever idea of using eval to skip writing a if else ladder. The input file had the following structure
Starting items: 91, 65 Operation: new = old * 13 Test: divisible by 5 If true: throw to monkey 7 If false: throw to monkey 4 I had to parse the file to get all values, but when parsing the second line I thought why not use the python interpretor itself."><meta name=author content><link rel=canonical href=https://lamichhaneaayush.com.np/posts/solveeval/><link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://lamichhaneaayush.com.np/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://lamichhaneaayush.com.np/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://lamichhaneaayush.com.np/favicon-32x32.png><link rel=apple-touch-icon href=https://lamichhaneaayush.com.np/apple-touch-icon.png><link rel=mask-icon href=https://lamichhaneaayush.com.np/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.110.0"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="Python: Solving slow eval"><meta property="og:description" content="Welcome to another one of my interesting findings, where I explore some stuff for fun and profit just fun
A while back I was solving AOC and for a problem (day 13), I had this sort of clever idea of using eval to skip writing a if else ladder. The input file had the following structure
Starting items: 91, 65 Operation: new = old * 13 Test: divisible by 5 If true: throw to monkey 7 If false: throw to monkey 4 I had to parse the file to get all values, but when parsing the second line I thought why not use the python interpretor itself."><meta property="og:type" content="article"><meta property="og:url" content="https://lamichhaneaayush.com.np/posts/solveeval/"><meta property="og:image" content="https://lamichhaneaayush.com.np/posts/solveeval/cover.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-01-10T20:49:42+05:45"><meta property="article:modified_time" content="2023-01-10T20:49:42+05:45"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://lamichhaneaayush.com.np/posts/solveeval/cover.png"><meta name=twitter:title content="Python: Solving slow eval"><meta name=twitter:description content="Welcome to another one of my interesting findings, where I explore some stuff for fun and profit just fun
A while back I was solving AOC and for a problem (day 13), I had this sort of clever idea of using eval to skip writing a if else ladder. The input file had the following structure
Starting items: 91, 65 Operation: new = old * 13 Test: divisible by 5 If true: throw to monkey 7 If false: throw to monkey 4 I had to parse the file to get all values, but when parsing the second line I thought why not use the python interpretor itself."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://lamichhaneaayush.com.np/posts/"},{"@type":"ListItem","position":2,"name":"Python: Solving slow eval","item":"https://lamichhaneaayush.com.np/posts/solveeval/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Python: Solving slow eval","name":"Python: Solving slow eval","description":"Welcome to another one of my interesting findings, where I explore some stuff for fun and profit just fun\nA while back I was solving AOC and for a problem (day 13), I had this sort of clever idea of using eval to skip writing a if else ladder. The input file had the following structure\nStarting items: 91, 65 Operation: new = old * 13 Test: divisible by 5 If true: throw to monkey 7 If false: throw to monkey 4 I had to parse the file to get all values, but when parsing the second line I thought why not use the python interpretor itself.","keywords":[],"articleBody":"Welcome to another one of my interesting findings, where I explore some stuff for fun and profit just fun\nA while back I was solving AOC and for a problem (day 13), I had this sort of clever idea of using eval to skip writing a if else ladder. The input file had the following structure\nStarting items: 91, 65 Operation: new = old * 13 Test: divisible by 5 If true: throw to monkey 7 If false: throw to monkey 4 I had to parse the file to get all values, but when parsing the second line I thought why not use the python interpretor itself. And so, I created a variable called old and whenever it needed updating I would use the following line\nold = eval( \"line 2 after the equal part\" ) The clever part was that I was skipping having to translate whatever symbol was present in the input (one of +, - , / or *) This was fine for the test input, but it became slow when I ran it against the larger input.\nI ran python -m cProfile main.py to find out that it was eval that took a bunch of time. It was being invoked a lot of time because it was called in the update loop.\nSo, I thought,\nwhy not store the function into a lambda before hand and then just call the lambda instead of calling eval? And that’s exactly what I did, and it worked. The unoptimized program took about 6 seconds when running on the complete input. But after I stored the operation in a lambda, it was basically instant. So, here is the main “trick”\noperation = eval(\"lambda old: \" + lines[2].split(\"=\")[1].strip()) Notice the parameter name of the lambda “old” it is necessary because the string is “old” in the input.\nSo, why is running eval repeatedly slow?\nEval is used for evaluating dynamic expressions, but we already have a fixed expression, so eval is doing extra work trying to evaluate the same expression many times, if we compile the expression to a lambda, we can just execute a lambda and it is a lot faster.\n","wordCount":"361","inLanguage":"en","image":"https://lamichhaneaayush.com.np/posts/solveeval/cover.png","datePublished":"2023-01-10T20:49:42+05:45","dateModified":"2023-01-10T20:49:42+05:45","mainEntityOfPage":{"@type":"WebPage","@id":"https://lamichhaneaayush.com.np/posts/solveeval/"},"publisher":{"@type":"Organization","name":"aayushprime","logo":{"@type":"ImageObject","url":"https://lamichhaneaayush.com.np/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://lamichhaneaayush.com.np/ accesskey=h title="aayushprime (Alt + H)">aayushprime</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://lamichhaneaayush.com.np/cv/ title=CV><span>CV</span></a></li><li><a href=https://lamichhaneaayush.com.np/about/ title=About><span>About</span></a></li><li><a href=https://lamichhaneaayush.com.np/posts/ title=Blog><span>Blog</span></a></li><li><a href=https://lamichhaneaayush.com.np/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Python: Solving slow eval</h1><div class=post-meta><span title='2023-01-10 20:49:42 +0545 +0545'>January 10, 2023</span></div></header><figure class=entry-cover><img loading=lazy src=https://lamichhaneaayush.com.np/posts/solveeval/cover.png alt="Failed image loading"></figure><div class=post-content><p>Welcome to another one of my interesting findings, where I explore some stuff for fun <del>and profit</del> <strong>just fun</strong></p><p>A while back I was solving <a href=https://adventofcode.com/>AOC</a> and for a problem (day 13), I had this sort of clever idea of using eval to skip writing a <code>if else</code> ladder.
The input file had the following structure</p><pre tabindex=0><code class=language-Monkey data-lang=Monkey>  Starting items: 91, 65
  Operation: new = old * 13
  Test: divisible by 5
    If true: throw to monkey 7
    If false: throw to monkey 4
</code></pre><p>I had to parse the file to get all values, but when parsing the second line I thought why not use the python interpretor itself. And so, I created a variable called <code>old</code> and whenever it needed updating I would use the following line</p><pre tabindex=0><code>old = eval( &#34;line 2 after the equal part&#34; )
</code></pre><p>The clever part was that I was skipping having to translate whatever symbol was present in the input (one of <code>+</code>, <code>-</code> , <code>/</code> or <code>*</code>)
This was fine for the <code>test</code> input, but it became slow when I ran it against the larger input.<br>I ran <code>python -m cProfile main.py</code> to find out that it was <code>eval</code> that took a bunch of time. It was being invoked a lot of time because it was called in the update loop.<br>So, I thought,<br>why not store the function into a lambda before hand and then just call the lambda instead of calling eval?
And that&rsquo;s exactly what I did, and it worked. The unoptimized program took about 6 seconds when running on the complete input. But after I stored the operation in a lambda, it was basically instant.
So, here is the main &ldquo;trick&rdquo;</p><pre tabindex=0><code>operation = eval(&#34;lambda old: &#34; + lines[2].split(&#34;=&#34;)[1].strip())
</code></pre><p>Notice the parameter name of the lambda &ldquo;old&rdquo; it is necessary because the string is &ldquo;old&rdquo; in the input.</p><blockquote><p>So, why is running eval repeatedly slow?<br>Eval is used for evaluating dynamic expressions, but we already have a fixed expression, so eval is doing extra work trying to evaluate the same expression many times, if we compile the expression to a lambda, we can just execute a lambda and it is a lot faster.</p></blockquote></div><footer class=post-footer></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://lamichhaneaayush.com.np/>aayushprime</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>